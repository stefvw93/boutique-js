var __defProp=Object.defineProperty,__defNormalProp=(t,e,i)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,__publicField=(t,e,i)=>(__defNormalProp(t,"symbol"!=typeof e?e+"":e,i),i);!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Boutique={})}(this,(function(t){"use strict";function e(t){Object.entries(t).forEach((([e,i])=>{const s=!e.startsWith("__"),n=t[e]instanceof Function;Object.defineProperty(t,e,{value:i,enumerable:s,configurable:s,writable:!n})}))}function i(t,e){for(;t.length>0;)e(t[0]),t.splice(0,1)}class s{constructor(){__publicField(this,"__updateQueue",[]),__publicField(this,"__callbackQueue",[]),__publicField(this,"__requestId"),__publicField(this,"__executeDomUpdates",(()=>{i(this.__updateQueue,(t=>t())),i(this.__callbackQueue,(t=>t()))})),e(this)}__queueDomUpdate(t,e){this.__requestId&&cancelAnimationFrame(this.__requestId),e&&this.__callbackQueue.push(e),t&&this.__updateQueue.push(t),this.__requestId=requestAnimationFrame(this.__executeDomUpdates)}}const n=class extends s{constructor(t,i){super(),__publicField(this,"children",[]),__publicField(this,"__parent"),__publicField(this,"__childSource"),__publicField(this,"__shouldUpdateIndices",[]),__publicField(this,"__shouldAppendIndices",[]),__publicField(this,"__shouldRemoveIndices",[]),this.__parent=t,this.__childSource=i,n.currentNode=this,this.children=this.__isDynamic(this.__childSource)?this.__childSource().map(this.__createChild.bind(this)):this.__childSource.map(this.__createChild.bind(this)),n.currentNode=void 0,e(this)}renderDom(){var t;void 0!==this.__parent.element&&(null==(t=this.__parent.element)||t.append(...this.children.reduce(((t,e)=>{var i,s,n;const r=null==(n=null==(s=(i=e.attributes).$if)?void 0:s.call(i))||n,_=e.renderDom(r);return r?t.concat(_):t}),[])))}updateDom(){const t=this.__parent.element;t&&this.__queueDomUpdate((()=>{try{const e=[];i(this.__shouldRemoveIndices,(i=>{e.push(t.children[i])})),e.forEach((t=>t.remove())),i(this.__shouldUpdateIndices,(e=>t.replaceChild(this.children[e].renderDom(),t.children[e]))),i(this.__shouldAppendIndices,(e=>t.appendChild(this.children[e].renderDom())))}catch(e){}}))}onStateChange(t){if(!this.__isDynamic(this.__childSource))return;const e=this.children.slice(),i=this.__childSource().map((t=>t())),s=Math.max(i.length,e.length),n=[];let r,_,a;for(let l=0;l<s;l++)r=e[l],_=i[l],(null==r?void 0:r.attributes.$key)!==(null==_?void 0:_.attributes.$key)?void 0!==_||void 0===r?void 0!==r||void 0===_?void 0!==r&&void 0!==_&&(a=e.find((t=>!!t.attributes.$key&&t.attributes.$key===_.attributes.$key)),a?n[l]=a:(n[l]=_,this.__shouldUpdateIndices.push(l))):(n[l]=_,this.__shouldAppendIndices.push(l)):this.__shouldRemoveIndices.push(l):n[l]=r;this.children=n,this.updateDom()}__createChild(t){const e=t();return e.parent=this.__parent,e}__isDynamic(t){return"function"==typeof t}};let r=n;__publicField(r,"currentNode");const _=class extends s{constructor(t,i,s){super(),__publicField(this,"parent"),__publicField(this,"element"),__publicField(this,"isFirstRender",!0),__publicField(this,"__attributeState",{$if:!0}),__publicField(this,"__changedStates",[]),__publicField(this,"__changedAttributes",[]),__publicField(this,"__childNodeList"),__publicField(this,"__doSetStaticAttributes",!0),__publicField(this,"__dynamicAttributes",[]),__publicField(this,"__doRenderDom",!1),__publicField(this,"__mountingElement"),this.tag=t,this.attributes=i,s&&(this.__childNodeList=new r(this,s)),this.__setAttributeState(),e(this)}static create(t,e={},i){return()=>new _(t,e,i)}get html(){var t,e,i;return[`<${this.tag}`,Object.entries(this.__attributeState).reduce(((t,[e,i])=>[e.startsWith("$"),this.__isEventName(e)].includes(!0)?t:t+` ${this.__getHtmlAttributeName(e)}="${i}"`),""),">",null!=(i=null!=(e=this.__attributeState.$text)?e:null==(t=this.__childNodeList)?void 0:t.children.map((t=>t.html)).join(""))?i:"",`</${this.tag}>`].join("")}get __parentElement(){var t,e;return null!=(e=null==(t=this.parent)?void 0:t.element)?e:this.__mountingElement}get __shouldRemove(){return this.__changedAttributes.includes("$if")&&!1===this.__attributeState.$if}get __shouldAppend(){return this.__changedAttributes.includes("$if")&&!0===this.__attributeState.$if}get __onAppend(){return this.__attributeState.$onAppend}get __onUpdate(){return this.__attributeState.$onUpdate}get __onRemove(){return this.__attributeState.$onRemove}mount(t){this.__mountingElement=t,t.innerHTML="",t.appendChild(this.renderDom(!0))}renderDom(t=!1){var e;if(!this.isFirstRender)throw new Error("Use update method instead.");return this.__doRenderDom=!0,this.__setAttributeState(),this.element=document.createElement(this.tag),this.__setElementAttributes(),null==(e=this.__childNodeList)||e.renderDom(),this.isFirstRender=!1,t&&this.__queueDomUpdate(void 0,(()=>{var t;return null==(t=this.__onAppend)?void 0:t.call(this,this.element)})),this.element}updateDom(){var t;this.__doRenderDom&&(this.__queueDomUpdate(this.__setElementAttributes.bind(this),null==(t=this.__onUpdate)?void 0:t.call(this,this.element)),this.__shouldAppend!=this.__shouldRemove&&this.__queueDomUpdate((()=>{var t,e;this.element&&(this.__shouldAppend&&(null==(t=this.__parentElement)||t.appendChild(this.element)),this.__shouldRemove&&(null==(e=this.__parentElement)||e.removeChild(this.element)))}),this.__shouldAppend?()=>{var t;return null==(t=this.__onAppend)?void 0:t.call(this,this.element)}:()=>{var t;return null==(t=this.__onRemove)?void 0:t.call(this,this.element)}))}onStateChange(t){this.__changedStates.push(t),this.__setAttributeState(),this.updateDom()}__setElementAttributes(){if(!this.element)return;(this.isFirstRender?Object.keys(this.__attributeState):this.__changedAttributes).forEach((t=>{const e=this.__attributeState[t];"$html"!==t?"$text"!==t?this.__isEventName(t)?this.element[this.__getHtmlAttributeName(t)]=e:"$"!==t[0]&&this.element.setAttribute(this.__getHtmlAttributeName(t),e):this.element.innerText=null!=e?String(e):"":this.element.innerHTML=null!=e?String(e):""}))}__setAttributeState(){let t,e;_.currentNode=this,this.__changedAttributes.splice(0,this.__changedAttributes.length),this.__doSetStaticAttributes?Object.entries(this.attributes).forEach((([i,s])=>{e=this.__isDynamicAttribute(i,s),t=e?s():s,this.__handleNewAttributeValue(i,t)})):this.__dynamicAttributes.forEach((e=>{t=this.attributes[e](),this.__handleNewAttributeValue(e,t)})),_.currentNode=void 0,this.__doSetStaticAttributes=!1}__handleNewAttributeValue(t,e){e!==this.__attributeState[t]&&(this.__changedAttributes.push(t),this.__attributeState[t]=e)}__isDynamicAttribute(t,e){return!t.startsWith("$on")&&("$if"===t||!this.__isEventName(t)&&"function"==typeof e)&&(this.__dynamicAttributes.push(t),!0)}__getHtmlAttributeName(t){if(this.__isEventName(t))return t.toLowerCase();switch(t){case"className":return"class"}return t.split(/(?=[A-Z])/).map((t=>t.toLowerCase())).join("-")}__isEventName(t){return t.startsWith("on")&&t.charAt(2)===t.charAt(2).toUpperCase()}};let a=_;__publicField(a,"currentNode");const l=t=>a.create.bind(void 0,t),h=l("a"),d=l("abbr"),u=l("acronym"),o=l("address"),c=l("area"),p=l("article"),m=l("aside"),b=l("audio"),f=l("b"),g=l("base"),v=l("bdi"),S=l("bdo"),A=l("big"),y=l("blink"),F=l("blockquote"),N=l("body"),k=l("br"),D=l("button"),$=l("canvas"),E=l("caption"),R=l("center"),w=l("cite"),C=l("code"),U=l("col"),x=l("colgroup"),q=l("content"),j=l("data"),I=l("datalist"),L=l("dd"),T=l("del"),O=l("details"),P=l("dfn"),H=l("div"),Q=l("dl"),M=l("dt"),V=l("element"),W=l("em"),B=l("embed"),Z=l("fieldset"),z=l("figcaption"),G=l("figure"),J=l("footer"),K=l("form"),X=l("h1"),Y=l("h2"),tt=l("h3"),et=l("h4"),it=l("h5"),st=l("h6"),nt=l("head"),rt=l("header"),_t=l("hr"),at=l("html"),lt=l("i"),ht=l("iframe"),dt=l("img"),ut=l("input"),ot=l("ins"),ct=l("kbd"),pt=l("label"),mt=l("legend"),bt=l("li"),ft=l("link"),gt=l("main"),vt=l("map"),St=l("mark"),At=l("menu"),yt=l("meta"),Ft=l("meter"),Nt=l("nav"),kt=l("noscript"),Dt=l("object"),$t=l("ol"),Et=l("optgroup"),Rt=l("option"),wt=l("output"),Ct=l("p"),Ut=l("param"),xt=l("plaintext"),qt=l("pre"),jt=l("progress"),It=l("q"),Lt=l("rp"),Tt=l("rt"),Ot=l("ruby"),Pt=l("s"),Ht=l("samp"),Qt=l("script"),Mt=l("section"),Vt=l("select"),Wt=l("small"),Bt=l("source"),Zt=l("span"),zt=l("strike"),Gt=l("strong"),Jt=l("style"),Kt=l("sub"),Xt=l("summary"),Yt=l("sup"),te=l("table"),ee=l("tbody"),ie=l("td"),se=l("template"),ne=l("textarea"),re=l("tfoot"),_e=l("th"),ae=l("thead"),le=l("time"),he=l("title"),de=l("tr"),ue=l("track"),oe=l("tt"),ce=l("u"),pe=l("ul"),me=l("var"),be=l("video"),fe=l("wbr"),ge=[];class ve{constructor(t){__publicField(this,"__boundNodes",[]),__publicField(this,"__listeners",[]),__publicField(this,"__trackReadCalls",!0),__publicField(this,"__internalState"),this.__internalState=t,e(this)}get state(){const t=this.__boundNodes,e=a.currentNode,i=r.currentNode;return this.__trackReadCalls&&(this.__trackReadCalls=!1,ge.push(this)),e&&!t.includes(e)&&t.push(e),i&&!t.includes(i)&&t.push(i),this.__internalState}set state(t){this.__updateState(t)}set(t){this.state=t(this.__internalState)}addListener(t){return this.__listeners.push(t),this}__updateState(t){t!==this.__internalState&&(this.__internalState=t,this.__listeners.forEach((t=>t(this.__internalState))),this.__boundNodes.forEach((t=>t.onStateChange(this))))}}class Se extends ve{constructor(t){super(void 0),__publicField(this,"__config"),this.__config=t,this.__internalState=t.getter(),i(ge,this.__handleTrackedStateUpdate.bind(this)),e(this)}__handleTrackedStateUpdate(t){t.addListener((()=>this.__updateState(this.__config.getter())))}set state(t){if(!this.__config.setter)throw new Error("Cannot update read-only state.");this.__config.setter(t)}}t.a=h,t.abbr=d,t.acronym=u,t.address=o,t.area=c,t.article=p,t.aside=m,t.audio=b,t.b=f,t.base=g,t.bdi=v,t.bdo=S,t.big=A,t.blink=y,t.blockquote=F,t.body=N,t.br=k,t.button=D,t.canvas=$,t.caption=E,t.center=R,t.cite=w,t.code=C,t.col=U,t.colgroup=x,t.computed=function(t){return new Se(t instanceof Function?{getter:t}:t)},t.content=q,t.data=j,t.datalist=I,t.dd=L,t.del=T,t.details=O,t.dfn=P,t.div=H,t.dl=Q,t.dt=M,t.element=V,t.em=W,t.embed=B,t.fieldset=Z,t.figcaption=z,t.figure=G,t.footer=J,t.form=K,t.h1=X,t.h2=Y,t.h3=tt,t.h4=et,t.h5=it,t.h6=st,t.head=nt,t.header=rt,t.hr=_t,t.html=at,t.htmlVar=me,t.i=lt,t.iframe=ht,t.img=dt,t.input=ut,t.ins=ot,t.kbd=ct,t.label=pt,t.legend=mt,t.li=bt,t.link=ft,t.main=gt,t.map=vt,t.mark=St,t.menu=At,t.meta=yt,t.meter=Ft,t.nav=Nt,t.noscript=kt,t.object=Dt,t.ol=$t,t.optgroup=Et,t.option=Rt,t.output=wt,t.p=Ct,t.param=Ut,t.plaintext=xt,t.pre=qt,t.progress=jt,t.q=It,t.rp=Lt,t.rt=Tt,t.ruby=Ot,t.s=Pt,t.samp=Ht,t.script=Qt,t.section=Mt,t.select=Vt,t.small=Wt,t.source=Bt,t.span=Zt,t.state=function(t){return new ve(t instanceof Function?t():t)},t.strike=zt,t.strong=Gt,t.style=Jt,t.sub=Kt,t.summary=Xt,t.sup=Yt,t.table=te,t.tbody=ee,t.td=ie,t.template=se,t.textarea=ne,t.tfoot=re,t.th=_e,t.thead=ae,t.time=le,t.title=he,t.tr=de,t.track=ue,t.tt=oe,t.u=ce,t.ul=pe,t.video=be,t.wbr=fe,Object.defineProperty(t,"__esModule",{value:!0}),t[Symbol.toStringTag]="Module"}));
