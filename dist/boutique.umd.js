var __defProp=Object.defineProperty,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__publicField=(e,t,i)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,i),i);!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Boutique={})}(this,(function(e){"use strict";function t(e){Object.entries(e).forEach((([t,i])=>{const n=!t.startsWith("__"),r=e[t]instanceof Function;Object.defineProperty(e,t,{value:i,enumerable:n,configurable:n,writable:!r})}))}class i{constructor(){__publicField(this,"__updateQueue",[]),__publicField(this,"__callbackQueue",[]),__publicField(this,"__requestId"),__publicField(this,"__executeDomUpdates",(()=>{for(;this.__updateQueue.length>0;)this.__updateQueue[0](),this.__updateQueue.splice(0,1);for(;this.__callbackQueue.length>0;)this.__callbackQueue[0](),this.__callbackQueue.splice(0,1)})),t(this)}__queueDomUpdate(e,t){this.__requestId&&cancelAnimationFrame(this.__requestId),t&&this.__callbackQueue.push(t),this.__updateQueue.push(e),this.__requestId=requestAnimationFrame(this.__executeDomUpdates)}}const n=class extends i{constructor(e,i){super(),__publicField(this,"children",[]),__publicField(this,"__parent"),__publicField(this,"__childSource"),__publicField(this,"__shouldUpdateIndices",[]),__publicField(this,"__shouldAppendIndices",[]),__publicField(this,"__shouldRemoveIndices",[]),this.__parent=e,this.__childSource=i,n.currentNode=this,this.children=this.__isDynamic(this.__childSource)?this.__childSource().map(this.__createChild.bind(this)):this.__childSource.map(this.__createChild.bind(this)),n.currentNode=void 0,t(this)}renderDom(){var e;void 0!==this.__parent.element&&(null==(e=this.__parent.element)||e.append(...this.children.reduce(((e,t)=>{var i,n,r;const s=null==(r=null==(n=(i=t.attributes).$if)?void 0:n.call(i))||r,a=t.renderDom(s);return s?e.concat(a):e}),[])))}updateDom(){const e=this.__parent.element;e&&this.__queueDomUpdate((()=>{for(;this.__shouldRemoveIndices.length>0;)e.children[this.__shouldRemoveIndices[0]].remove(),this.__shouldRemoveIndices.splice(0,1);for(;this.__shouldUpdateIndices.length>0;)e.replaceChild(this.children[this.__shouldUpdateIndices[0]].renderDom(),e.children[this.__shouldUpdateIndices[0]]),this.__shouldUpdateIndices.splice(0,1);for(;this.__shouldAppendIndices.length>0;)e.appendChild(this.children[this.__shouldAppendIndices[0]].renderDom()),this.__shouldAppendIndices.splice(0,1)}))}onStateChange(e){if(!this.__isDynamic(this.__childSource))return;const t=this.children.slice(),i=this.__childSource().map((e=>e())),n=Math.max(i.length,t.length),r=[];let s,a,d;for(let c=0;c<n;c++)s=t[c],a=i[c],(null==s?void 0:s.attributes.$key)!==(null==a?void 0:a.attributes.$key)?void 0!==a||void 0===s?void 0!==s||void 0===a?void 0!==s&&void 0!==a&&(d=t.find((e=>!!e.attributes.$key&&e.attributes.$key===a.attributes.$key)),d?r[c]=d:(r[c]=a,this.__shouldUpdateIndices.push(c))):(r[c]=a,this.__shouldAppendIndices.push(c)):this.__shouldRemoveIndices.push(c):r[c]=s;this.children=r,this.updateDom()}__createChild(e){const t=e();return t.parent=this.__parent,t}__isDynamic(e){return"function"==typeof e}};let r=n;__publicField(r,"currentNode");const s=[],a=class extends i{constructor(e,i,n,s=[]){super(),__publicField(this,"parent"),__publicField(this,"element"),__publicField(this,"isFirstRender",!0),__publicField(this,"__attributeState",{$if:!0}),__publicField(this,"__changedStates",[]),__publicField(this,"__boundEffects"),__publicField(this,"__changedAttributes",[]),__publicField(this,"__childNodeList"),__publicField(this,"__doSetStaticAttributes",!0),__publicField(this,"__dynamicAttributes",[]),__publicField(this,"__doRenderDom",!1),__publicField(this,"__mountingElement"),this.tag=e,this.attributes=i,this.__boundEffects=s,n&&(this.__childNodeList=new r(this,n)),this.__setAttributeState(),t(this)}static create(e,t={},i){const n=s.slice();return s.splice(0,s.length),()=>new a(e,t,i,n)}get html(){return[`<${this.tag}`,(()=>Object.entries(this.__attributeState).reduce(((e,[t,i])=>[t.startsWith("$"),t.startsWith("on")].includes(!0)?e:e+` ${this.__getHtmlAttributeName(t)}="${i}"`),""))(),">",(()=>{var e,t,i;return null!=(i=null!=(t=this.__attributeState.$text)?t:null==(e=this.__childNodeList)?void 0:e.children.map((e=>e.html)).join(""))?i:""})(),`</${this.tag}>`].join("")}get __parentElement(){var e,t;return null!=(t=null==(e=this.parent)?void 0:e.element)?t:this.__mountingElement}get __shouldRemove(){return this.__changedAttributes.includes("$if")&&!1===this.__attributeState.$if}get __shouldAppend(){return this.__changedAttributes.includes("$if")&&!0===this.__attributeState.$if}mount(e){this.__mountingElement=e,e.innerHTML="",e.appendChild(this.renderDom(!0))}renderDom(e=!1){var t;if(!this.isFirstRender)throw new Error("Use update method instead.");return this.__doRenderDom=!0,this.__setAttributeState(),this.element=document.createElement(this.tag),this.__setElementAttributes(),null==(t=this.__childNodeList)||t.renderDom(),this.isFirstRender=!1,e&&this.__queueDomUpdate((()=>{this.__boundEffects.forEach((e=>e.dispatch()))})),this.element}updateDom(){this.__doRenderDom&&(this.__shouldAppend!=this.__shouldRemove&&this.__queueDomUpdate((()=>{var e,t;this.element&&(this.__shouldAppend&&(null==(e=this.__parentElement)||e.appendChild(this.element)),this.__shouldRemove&&(null==(t=this.__parentElement)||t.removeChild(this.element)))}),this.__shouldAppend?()=>{this.__boundEffects.forEach((e=>e.dispatch()))}:()=>{this.__boundEffects.forEach((e=>e.cleanup()))}),this.__queueDomUpdate(this.__setElementAttributes.bind(this),(()=>{for(;this.__changedStates.length>0;)this.__boundEffects.forEach((e=>{e.dispatch(this.__changedStates[0])})),this.__changedStates.splice(0,1)})))}onStateChange(e){this.__changedStates.push(e),this.__setAttributeState(),this.updateDom()}__setElementAttributes(){if(!this.element)return;(this.isFirstRender?Object.keys(this.__attributeState):this.__changedAttributes).forEach((e=>{const t=this.__attributeState[e];"$html"!==e?"$text"!==e?"on"!==e.substr(0,2)?"on"!==e.substr(0,2)&&"$"!==e[0]&&this.element.setAttribute(this.__getHtmlAttributeName(e),t):this.element[e]=t:this.element.innerText=null!=t?String(t):"":this.element.innerHTML=null!=t?String(t):""}))}__setAttributeState(){let e,t;a.currentNode=this,this.__changedAttributes.splice(0,this.__changedAttributes.length),this.__doSetStaticAttributes?Object.entries(this.attributes).forEach((([i,n])=>{t=this.__isDynamicAttribute(i,n),t?(this.__dynamicAttributes.push(i),e=n()):e=n,e!==this.__attributeState[i]&&(this.__changedAttributes.push(i),this.__attributeState[i]=e)})):this.__dynamicAttributes.forEach((t=>{e=this.attributes[t](),e!==this.__attributeState[t]&&(this.__changedAttributes.push(t),this.__attributeState[t]=e)})),a.currentNode=void 0,this.__doSetStaticAttributes=!1}__isDynamicAttribute(e,t){return"$if"===e||"on"!==e.substr(0,2)&&"function"==typeof t}__getHtmlAttributeName(e){switch(e){case"className":return"class"}return e.split(/(?=[A-Z])/).map((e=>e.toLowerCase())).join("-")}};let d=a;__publicField(d,"currentNode");const c=void 0,_=d.create.bind(c,"a"),h=d.create.bind(c,"abbr"),l=d.create.bind(c,"acronym"),u=d.create.bind(c,"address"),b=d.create.bind(c,"applet"),o=d.create.bind(c,"area"),p=d.create.bind(c,"article"),m=d.create.bind(c,"aside"),f=d.create.bind(c,"audio"),g=d.create.bind(c,"b"),v=d.create.bind(c,"base"),S=d.create.bind(c,"basefont"),y=d.create.bind(c,"bdi"),A=d.create.bind(c,"bdo"),F=d.create.bind(c,"bgsound"),k=d.create.bind(c,"big"),E=d.create.bind(c,"blink"),D=d.create.bind(c,"blockquote"),N=d.create.bind(c,"body"),$=d.create.bind(c,"br"),I=d.create.bind(c,"button"),w=d.create.bind(c,"canvas"),x=d.create.bind(c,"caption"),q=d.create.bind(c,"center"),R=d.create.bind(c,"cite"),U=d.create.bind(c,"code"),j=d.create.bind(c,"col"),C=d.create.bind(c,"colgroup"),Q=d.create.bind(c,"content"),L=d.create.bind(c,"data"),O=d.create.bind(c,"datalist"),P=d.create.bind(c,"dd"),T=d.create.bind(c,"decorator"),H=d.create.bind(c,"del"),M=d.create.bind(c,"details"),W=d.create.bind(c,"dfn"),B=d.create.bind(c,"dir"),V=d.create.bind(c,"div"),Z=d.create.bind(c,"dl"),z=d.create.bind(c,"dt"),G=d.create.bind(c,"element"),J=d.create.bind(c,"em"),K=d.create.bind(c,"embed"),X=d.create.bind(c,"fieldset"),Y=d.create.bind(c,"figcaption"),ee=d.create.bind(c,"figure"),te=d.create.bind(c,"font"),ie=d.create.bind(c,"footer"),ne=d.create.bind(c,"form"),re=d.create.bind(c,"frame"),se=d.create.bind(c,"frameset"),ae=d.create.bind(c,"h1"),de=d.create.bind(c,"h2"),ce=d.create.bind(c,"h3"),_e=d.create.bind(c,"h4"),he=d.create.bind(c,"h5"),le=d.create.bind(c,"h6"),ue=d.create.bind(c,"head"),be=d.create.bind(c,"header"),oe=d.create.bind(c,"hgroup"),pe=d.create.bind(c,"hr"),me=d.create.bind(c,"html"),fe=d.create.bind(c,"i"),ge=d.create.bind(c,"iframe"),ve=d.create.bind(c,"img"),Se=d.create.bind(c,"input"),ye=d.create.bind(c,"ins"),Ae=d.create.bind(c,"isindex"),Fe=d.create.bind(c,"kbd"),ke=d.create.bind(c,"keygen"),Ee=d.create.bind(c,"label"),De=d.create.bind(c,"legend"),Ne=d.create.bind(c,"li"),$e=d.create.bind(c,"link"),Ie=d.create.bind(c,"listing"),we=d.create.bind(c,"main"),xe=d.create.bind(c,"map"),qe=d.create.bind(c,"mark"),Re=d.create.bind(c,"marquee"),Ue=d.create.bind(c,"menu"),je=d.create.bind(c,"menuitem"),Ce=d.create.bind(c,"meta"),Qe=d.create.bind(c,"meter"),Le=d.create.bind(c,"nav"),Oe=d.create.bind(c,"nobr"),Pe=d.create.bind(c,"noframes"),Te=d.create.bind(c,"noscript"),He=d.create.bind(c,"object"),Me=d.create.bind(c,"ol"),We=d.create.bind(c,"optgroup"),Be=d.create.bind(c,"option"),Ve=d.create.bind(c,"output"),Ze=d.create.bind(c,"p"),ze=d.create.bind(c,"param"),Ge=d.create.bind(c,"plaintext"),Je=d.create.bind(c,"pre"),Ke=d.create.bind(c,"progress"),Xe=d.create.bind(c,"q"),Ye=d.create.bind(c,"rp"),et=d.create.bind(c,"rt"),tt=d.create.bind(c,"ruby"),it=d.create.bind(c,"s"),nt=d.create.bind(c,"samp"),rt=d.create.bind(c,"script"),st=d.create.bind(c,"section"),at=d.create.bind(c,"select"),dt=d.create.bind(c,"shadow"),ct=d.create.bind(c,"small"),_t=d.create.bind(c,"source"),ht=d.create.bind(c,"spacer"),lt=d.create.bind(c,"span"),ut=d.create.bind(c,"strike"),bt=d.create.bind(c,"strong"),ot=d.create.bind(c,"style"),pt=d.create.bind(c,"sub"),mt=d.create.bind(c,"summary"),ft=d.create.bind(c,"sup"),gt=d.create.bind(c,"table"),vt=d.create.bind(c,"tbody"),St=d.create.bind(c,"td"),yt=d.create.bind(c,"template"),At=d.create.bind(c,"textarea"),Ft=d.create.bind(c,"tfoot"),kt=d.create.bind(c,"th"),Et=d.create.bind(c,"thead"),Dt=d.create.bind(c,"time"),Nt=d.create.bind(c,"title"),$t=d.create.bind(c,"tr"),It=d.create.bind(c,"track"),wt=d.create.bind(c,"tt"),xt=d.create.bind(c,"u"),qt=d.create.bind(c,"ul"),Rt=d.create.bind(c,"var"),Ut=d.create.bind(c,"video"),jt=d.create.bind(c,"wbr"),Ct=d.create.bind(c,"xmp");class Qt{constructor(e){__publicField(this,"__boundNodes",[]),__publicField(this,"__internalState"),__publicField(this,"__listeners",[]),this.__internalState=e,t(this)}get state(){const e=this.__boundNodes,t=d.currentNode,i=r.currentNode;return t&&!e.includes(t)&&e.push(t),i&&!e.includes(i)&&e.push(i),this.__internalState}set state(e){e!==this.__internalState&&(this.__internalState=e,this.__listeners.forEach((e=>e(this))),this.__boundNodes.forEach((e=>e.onStateChange(this))))}set(e){this.state=e(this.__internalState)}addListener(e){return this.__listeners.push(e),this}}class Lt{constructor(e,i){__publicField(this,"__callback"),__publicField(this,"__cleanup"),__publicField(this,"__watch"),this.__callback=e,this.__watch=i,t(this)}static isEffect(e){var t;return"Effect"===(null==(t=e.constructor)?void 0:t.name)}dispatch(e){e&&this.__watch&&!this.__watch.includes(e)||(this.__cleanup=this.__callback())}cleanup(){var e;null==(e=this.__cleanup)||e.call(this)}}e.Effect=Lt,e.State=Qt,e.a=_,e.abbr=h,e.acronym=l,e.address=u,e.applet=b,e.area=o,e.article=p,e.aside=m,e.audio=f,e.b=g,e.base=v,e.basefont=S,e.bdi=y,e.bdo=A,e.bgsound=F,e.big=k,e.blink=E,e.blockquote=D,e.body=N,e.br=$,e.button=I,e.canvas=w,e.caption=x,e.center=q,e.cite=R,e.code=U,e.col=j,e.colgroup=C,e.content=Q,e.data=L,e.datalist=O,e.dd=P,e.decorator=T,e.del=H,e.details=M,e.dfn=W,e.dir=B,e.div=V,e.dl=Z,e.dt=z,e.effect=function(e,t){"function"==typeof e?s.push(new Lt(e)):t&&s.push(new Lt(t,e))},e.element=G,e.em=J,e.embed=K,e.fieldset=X,e.figcaption=Y,e.figure=ee,e.font=te,e.footer=ie,e.form=ne,e.frame=re,e.frameset=se,e.h1=ae,e.h2=de,e.h3=ce,e.h4=_e,e.h5=he,e.h6=le,e.head=ue,e.header=be,e.hgroup=oe,e.hr=pe,e.html=me,e.htmlVar=Rt,e.i=fe,e.iframe=ge,e.img=ve,e.input=Se,e.ins=ye,e.isindex=Ae,e.kbd=Fe,e.keygen=ke,e.label=Ee,e.legend=De,e.li=Ne,e.link=$e,e.listing=Ie,e.main=we,e.map=xe,e.mark=qe,e.marquee=Re,e.menu=Ue,e.menuitem=je,e.meta=Ce,e.meter=Qe,e.nav=Le,e.nobr=Oe,e.noframes=Pe,e.noscript=Te,e.object=He,e.ol=Me,e.optgroup=We,e.option=Be,e.output=Ve,e.p=Ze,e.param=ze,e.plaintext=Ge,e.pre=Je,e.progress=Ke,e.q=Xe,e.rp=Ye,e.rt=et,e.ruby=tt,e.s=it,e.samp=nt,e.script=rt,e.section=st,e.select=at,e.shadow=dt,e.small=ct,e.source=_t,e.spacer=ht,e.span=lt,e.state=function(e){return new Qt(e instanceof Function?e():e)},e.strike=ut,e.strong=bt,e.style=ot,e.sub=pt,e.summary=mt,e.sup=ft,e.table=gt,e.tbody=vt,e.td=St,e.template=yt,e.textarea=At,e.tfoot=Ft,e.th=kt,e.thead=Et,e.time=Dt,e.title=Nt,e.tr=$t,e.track=It,e.tt=wt,e.u=xt,e.ul=qt,e.video=Ut,e.wbr=jt,e.xmp=Ct,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
