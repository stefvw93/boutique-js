var e=Object.defineProperty,t=(t,i,n)=>(((t,i,n)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n})(t,"symbol"!=typeof i?i+"":i,n),n);function i(e){Object.entries(e).forEach((([t,i])=>{const n=!t.startsWith("__"),s=e[t]instanceof Function;Object.defineProperty(e,t,{value:i,enumerable:n,configurable:n,writable:!s})}))}class n{constructor(){t(this,"__updateQueue",[]),t(this,"__callbackQueue",[]),t(this,"__requestId"),t(this,"__executeDomUpdates",(()=>{for(;this.__updateQueue.length>0;)this.__updateQueue[0](),this.__updateQueue.splice(0,1);for(;this.__callbackQueue.length>0;)this.__callbackQueue[0](),this.__callbackQueue.splice(0,1)})),i(this)}__queueDomUpdate(e,t){this.__requestId&&cancelAnimationFrame(this.__requestId),t&&this.__callbackQueue.push(t),this.__updateQueue.push(e),this.__requestId=requestAnimationFrame(this.__executeDomUpdates)}}const s=class extends n{constructor(e,n){super(),t(this,"children",[]),t(this,"__parent"),t(this,"__childSource"),t(this,"__shouldUpdateIndices",[]),t(this,"__shouldAppendIndices",[]),t(this,"__shouldRemoveIndices",[]),this.__parent=e,this.__childSource=n,s.currentNode=this,this.children=this.__isDynamic(this.__childSource)?this.__childSource().map(this.__createChild.bind(this)):this.__childSource.map(this.__createChild.bind(this)),s.currentNode=void 0,i(this)}renderDom(){var e;void 0!==this.__parent.element&&(null==(e=this.__parent.element)||e.append(...this.children.reduce(((e,t)=>{var i,n,s;const r=null==(s=null==(n=(i=t.attributes).$if)?void 0:n.call(i))||s,a=t.renderDom(r);return r?e.concat(a):e}),[])))}updateDom(){const e=this.__parent.element;e&&this.__queueDomUpdate((()=>{for(;this.__shouldRemoveIndices.length>0;)e.children[this.__shouldRemoveIndices[0]].remove(),this.__shouldRemoveIndices.splice(0,1);for(;this.__shouldUpdateIndices.length>0;)e.replaceChild(this.children[this.__shouldUpdateIndices[0]].renderDom(),e.children[this.__shouldUpdateIndices[0]]),this.__shouldUpdateIndices.splice(0,1);for(;this.__shouldAppendIndices.length>0;)e.appendChild(this.children[this.__shouldAppendIndices[0]].renderDom()),this.__shouldAppendIndices.splice(0,1)}))}onStateChange(e){if(!this.__isDynamic(this.__childSource))return;const t=this.children.slice(),i=this.__childSource().map((e=>e())),n=Math.max(i.length,t.length),s=[];let r,a,d;for(let c=0;c<n;c++)r=t[c],a=i[c],(null==r?void 0:r.attributes.$key)!==(null==a?void 0:a.attributes.$key)?void 0!==a||void 0===r?void 0!==r||void 0===a?void 0!==r&&void 0!==a&&(d=t.find((e=>!!e.attributes.$key&&e.attributes.$key===a.attributes.$key)),d?s[c]=d:(s[c]=a,this.__shouldUpdateIndices.push(c))):(s[c]=a,this.__shouldAppendIndices.push(c)):this.__shouldRemoveIndices.push(c):s[c]=r;this.children=s,this.updateDom()}__createChild(e){const t=e();return t.parent=this.__parent,t}__isDynamic(e){return"function"==typeof e}};let r=s;t(r,"currentNode");const a=[],d=class extends n{constructor(e,n,s,a=[]){super(),t(this,"parent"),t(this,"element"),t(this,"isFirstRender",!0),t(this,"__attributeState",{$if:!0}),t(this,"__changedStates",[]),t(this,"__boundEffects"),t(this,"__changedAttributes",[]),t(this,"__childNodeList"),t(this,"__doSetStaticAttributes",!0),t(this,"__dynamicAttributes",[]),t(this,"__doRenderDom",!1),t(this,"__mountingElement"),this.tag=e,this.attributes=n,this.__boundEffects=a,s&&(this.__childNodeList=new r(this,s)),this.__setAttributeState(),i(this)}static create(e,t={},i){const n=a.slice();return a.splice(0,a.length),()=>new d(e,t,i,n)}get html(){return[`<${this.tag}`,(()=>Object.entries(this.__attributeState).reduce(((e,[t,i])=>[t.startsWith("$"),t.startsWith("on")].includes(!0)?e:e+` ${this.__getHtmlAttributeName(t)}="${i}"`),""))(),">",(()=>{var e,t,i;return null!=(i=null!=(t=this.__attributeState.$text)?t:null==(e=this.__childNodeList)?void 0:e.children.map((e=>e.html)).join(""))?i:""})(),`</${this.tag}>`].join("")}get __parentElement(){var e,t;return null!=(t=null==(e=this.parent)?void 0:e.element)?t:this.__mountingElement}get __shouldRemove(){return this.__changedAttributes.includes("$if")&&!1===this.__attributeState.$if}get __shouldAppend(){return this.__changedAttributes.includes("$if")&&!0===this.__attributeState.$if}mount(e){this.__mountingElement=e,e.innerHTML="",e.appendChild(this.renderDom(!0))}renderDom(e=!1){var t;if(!this.isFirstRender)throw new Error("Use update method instead.");return this.__doRenderDom=!0,this.__setAttributeState(),this.element=document.createElement(this.tag),this.__setElementAttributes(),null==(t=this.__childNodeList)||t.renderDom(),this.isFirstRender=!1,e&&this.__queueDomUpdate((()=>{this.__boundEffects.forEach((e=>e.dispatch()))})),this.element}updateDom(){this.__doRenderDom&&(this.__shouldAppend!=this.__shouldRemove&&this.__queueDomUpdate((()=>{var e,t;this.element&&(this.__shouldAppend&&(null==(e=this.__parentElement)||e.appendChild(this.element)),this.__shouldRemove&&(null==(t=this.__parentElement)||t.removeChild(this.element)))}),this.__shouldAppend?()=>{this.__boundEffects.forEach((e=>e.dispatch()))}:()=>{this.__boundEffects.forEach((e=>e.cleanup()))}),this.__queueDomUpdate(this.__setElementAttributes.bind(this),(()=>{for(;this.__changedStates.length>0;)this.__boundEffects.forEach((e=>{e.dispatch(this.__changedStates[0])})),this.__changedStates.splice(0,1)})))}onStateChange(e){this.__changedStates.push(e),this.__setAttributeState(),this.updateDom()}__setElementAttributes(){if(!this.element)return;(this.isFirstRender?Object.keys(this.__attributeState):this.__changedAttributes).forEach((e=>{const t=this.__attributeState[e];"$html"!==e?"$text"!==e?"on"!==e.substr(0,2)?"on"!==e.substr(0,2)&&"$"!==e[0]&&this.element.setAttribute(this.__getHtmlAttributeName(e),t):this.element[e]=t:this.element.innerText=null!=t?String(t):"":this.element.innerHTML=null!=t?String(t):""}))}__setAttributeState(){let e,t;d.currentNode=this,this.__changedAttributes.splice(0,this.__changedAttributes.length),this.__doSetStaticAttributes?Object.entries(this.attributes).forEach((([i,n])=>{t=this.__isDynamicAttribute(i,n),t?(this.__dynamicAttributes.push(i),e=n()):e=n,e!==this.__attributeState[i]&&(this.__changedAttributes.push(i),this.__attributeState[i]=e)})):this.__dynamicAttributes.forEach((t=>{e=this.attributes[t](),e!==this.__attributeState[t]&&(this.__changedAttributes.push(t),this.__attributeState[t]=e)})),d.currentNode=void 0,this.__doSetStaticAttributes=!1}__isDynamicAttribute(e,t){return"$if"===e||"on"!==e.substr(0,2)&&"function"==typeof t}__getHtmlAttributeName(e){switch(e){case"className":return"class"}return e.split(/(?=[A-Z])/).map((e=>e.toLowerCase())).join("-")}};let c=d;t(c,"currentNode");const h=void 0,_=c.create.bind(h,"a"),u=c.create.bind(h,"abbr"),b=c.create.bind(h,"acronym"),o=c.create.bind(h,"address"),l=c.create.bind(h,"applet"),p=c.create.bind(h,"area"),m=c.create.bind(h,"article"),f=c.create.bind(h,"aside"),g=c.create.bind(h,"audio"),S=c.create.bind(h,"b"),v=c.create.bind(h,"base"),A=c.create.bind(h,"basefont"),E=c.create.bind(h,"bdi"),y=c.create.bind(h,"bdo"),D=c.create.bind(h,"bgsound"),k=c.create.bind(h,"big"),$=c.create.bind(h,"blink"),I=c.create.bind(h,"blockquote"),N=c.create.bind(h,"body"),w=c.create.bind(h,"br"),R=c.create.bind(h,"button"),U=c.create.bind(h,"canvas"),q=c.create.bind(h,"caption"),x=c.create.bind(h,"center"),C=c.create.bind(h,"cite"),j=c.create.bind(h,"code"),Q=c.create.bind(h,"col"),F=c.create.bind(h,"colgroup"),L=c.create.bind(h,"content"),O=c.create.bind(h,"data"),H=c.create.bind(h,"datalist"),M=c.create.bind(h,"dd"),T=c.create.bind(h,"decorator"),W=c.create.bind(h,"del"),P=c.create.bind(h,"details"),Z=c.create.bind(h,"dfn"),z=c.create.bind(h,"dir"),B=c.create.bind(h,"div"),G=c.create.bind(h,"dl"),J=c.create.bind(h,"dt"),K=c.create.bind(h,"element"),V=c.create.bind(h,"em"),X=c.create.bind(h,"embed"),Y=c.create.bind(h,"fieldset"),ee=c.create.bind(h,"figcaption"),te=c.create.bind(h,"figure"),ie=c.create.bind(h,"font"),ne=c.create.bind(h,"footer"),se=c.create.bind(h,"form"),re=c.create.bind(h,"frame"),ae=c.create.bind(h,"frameset"),de=c.create.bind(h,"h1"),ce=c.create.bind(h,"h2"),he=c.create.bind(h,"h3"),_e=c.create.bind(h,"h4"),ue=c.create.bind(h,"h5"),be=c.create.bind(h,"h6"),oe=c.create.bind(h,"head"),le=c.create.bind(h,"header"),pe=c.create.bind(h,"hgroup"),me=c.create.bind(h,"hr"),fe=c.create.bind(h,"html"),ge=c.create.bind(h,"i"),Se=c.create.bind(h,"iframe"),ve=c.create.bind(h,"img"),Ae=c.create.bind(h,"input"),Ee=c.create.bind(h,"ins"),ye=c.create.bind(h,"isindex"),De=c.create.bind(h,"kbd"),ke=c.create.bind(h,"keygen"),$e=c.create.bind(h,"label"),Ie=c.create.bind(h,"legend"),Ne=c.create.bind(h,"li"),we=c.create.bind(h,"link"),Re=c.create.bind(h,"listing"),Ue=c.create.bind(h,"main"),qe=c.create.bind(h,"map"),xe=c.create.bind(h,"mark"),Ce=c.create.bind(h,"marquee"),je=c.create.bind(h,"menu"),Qe=c.create.bind(h,"menuitem"),Fe=c.create.bind(h,"meta"),Le=c.create.bind(h,"meter"),Oe=c.create.bind(h,"nav"),He=c.create.bind(h,"nobr"),Me=c.create.bind(h,"noframes"),Te=c.create.bind(h,"noscript"),We=c.create.bind(h,"object"),Pe=c.create.bind(h,"ol"),Ze=c.create.bind(h,"optgroup"),ze=c.create.bind(h,"option"),Be=c.create.bind(h,"output"),Ge=c.create.bind(h,"p"),Je=c.create.bind(h,"param"),Ke=c.create.bind(h,"plaintext"),Ve=c.create.bind(h,"pre"),Xe=c.create.bind(h,"progress"),Ye=c.create.bind(h,"q"),et=c.create.bind(h,"rp"),tt=c.create.bind(h,"rt"),it=c.create.bind(h,"ruby"),nt=c.create.bind(h,"s"),st=c.create.bind(h,"samp"),rt=c.create.bind(h,"script"),at=c.create.bind(h,"section"),dt=c.create.bind(h,"select"),ct=c.create.bind(h,"shadow"),ht=c.create.bind(h,"small"),_t=c.create.bind(h,"source"),ut=c.create.bind(h,"spacer"),bt=c.create.bind(h,"span"),ot=c.create.bind(h,"strike"),lt=c.create.bind(h,"strong"),pt=c.create.bind(h,"style"),mt=c.create.bind(h,"sub"),ft=c.create.bind(h,"summary"),gt=c.create.bind(h,"sup"),St=c.create.bind(h,"table"),vt=c.create.bind(h,"tbody"),At=c.create.bind(h,"td"),Et=c.create.bind(h,"template"),yt=c.create.bind(h,"textarea"),Dt=c.create.bind(h,"tfoot"),kt=c.create.bind(h,"th"),$t=c.create.bind(h,"thead"),It=c.create.bind(h,"time"),Nt=c.create.bind(h,"title"),wt=c.create.bind(h,"tr"),Rt=c.create.bind(h,"track"),Ut=c.create.bind(h,"tt"),qt=c.create.bind(h,"u"),xt=c.create.bind(h,"ul"),Ct=c.create.bind(h,"var"),jt=c.create.bind(h,"video"),Qt=c.create.bind(h,"wbr"),Ft=c.create.bind(h,"xmp");class Lt{constructor(e){t(this,"__boundNodes",[]),t(this,"__internalState"),t(this,"__listeners",[]),this.__internalState=e,i(this)}get state(){const e=this.__boundNodes,t=c.currentNode,i=r.currentNode;return t&&!e.includes(t)&&e.push(t),i&&!e.includes(i)&&e.push(i),this.__internalState}set state(e){e!==this.__internalState&&(this.__internalState=e,this.__listeners.forEach((e=>e(this))),this.__boundNodes.forEach((e=>e.onStateChange(this))))}set(e){this.state=e(this.__internalState)}addListener(e){return this.__listeners.push(e),this}}function Ot(e){return new Lt(e instanceof Function?e():e)}class Ht{constructor(e,n){t(this,"__callback"),t(this,"__cleanup"),t(this,"__watch"),this.__callback=e,this.__watch=n,i(this)}static isEffect(e){var t;return"Effect"===(null==(t=e.constructor)?void 0:t.name)}dispatch(e){e&&this.__watch&&!this.__watch.includes(e)||(this.__cleanup=this.__callback())}cleanup(){var e;null==(e=this.__cleanup)||e.call(this)}}function Mt(e,t){"function"==typeof e?a.push(new Ht(e)):t&&a.push(new Ht(t,e))}export{Ht as Effect,Lt as State,_ as a,u as abbr,b as acronym,o as address,l as applet,p as area,m as article,f as aside,g as audio,S as b,v as base,A as basefont,E as bdi,y as bdo,D as bgsound,k as big,$ as blink,I as blockquote,N as body,w as br,R as button,U as canvas,q as caption,x as center,C as cite,j as code,Q as col,F as colgroup,L as content,O as data,H as datalist,M as dd,T as decorator,W as del,P as details,Z as dfn,z as dir,B as div,G as dl,J as dt,Mt as effect,K as element,V as em,X as embed,Y as fieldset,ee as figcaption,te as figure,ie as font,ne as footer,se as form,re as frame,ae as frameset,de as h1,ce as h2,he as h3,_e as h4,ue as h5,be as h6,oe as head,le as header,pe as hgroup,me as hr,fe as html,Ct as htmlVar,ge as i,Se as iframe,ve as img,Ae as input,Ee as ins,ye as isindex,De as kbd,ke as keygen,$e as label,Ie as legend,Ne as li,we as link,Re as listing,Ue as main,qe as map,xe as mark,Ce as marquee,je as menu,Qe as menuitem,Fe as meta,Le as meter,Oe as nav,He as nobr,Me as noframes,Te as noscript,We as object,Pe as ol,Ze as optgroup,ze as option,Be as output,Ge as p,Je as param,Ke as plaintext,Ve as pre,Xe as progress,Ye as q,et as rp,tt as rt,it as ruby,nt as s,st as samp,rt as script,at as section,dt as select,ct as shadow,ht as small,_t as source,ut as spacer,bt as span,Ot as state,ot as strike,lt as strong,pt as style,mt as sub,ft as summary,gt as sup,St as table,vt as tbody,At as td,Et as template,yt as textarea,Dt as tfoot,kt as th,$t as thead,It as time,Nt as title,wt as tr,Rt as track,Ut as tt,qt as u,xt as ul,jt as video,Qt as wbr,Ft as xmp};
