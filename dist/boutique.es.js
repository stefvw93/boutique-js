var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);function i(t){Object.entries(t).forEach((([e,i])=>{const s=!e.startsWith("__"),n=t[e]instanceof Function;Object.defineProperty(t,e,{value:i,enumerable:s,configurable:s,writable:!n})}))}class s{constructor(){e(this,"__updateQueue",[]),e(this,"__callbackQueue",[]),e(this,"__requestId"),e(this,"__executeDomUpdates",(()=>{for(;this.__updateQueue.length>0;)this.__updateQueue[0](),this.__updateQueue.splice(0,1);for(;this.__callbackQueue.length>0;)this.__callbackQueue[0](),this.__callbackQueue.splice(0,1)})),i(this)}__queueDomUpdate(t,e){this.__requestId&&cancelAnimationFrame(this.__requestId),e&&this.__callbackQueue.push(e),this.__updateQueue.push(t),this.__requestId=requestAnimationFrame(this.__executeDomUpdates)}}function n(t,e){for(;t.length>0;)e(t[0]),t.splice(0,1)}const h=class extends s{constructor(t,s){super(),e(this,"children",[]),e(this,"__parent"),e(this,"__childSource"),e(this,"__shouldUpdateIndices",[]),e(this,"__shouldAppendIndices",[]),e(this,"__shouldRemoveIndices",[]),this.__parent=t,this.__childSource=s,h.currentNode=this,this.children=this.__isDynamic(this.__childSource)?this.__childSource().map(this.__createChild.bind(this)):this.__childSource.map(this.__createChild.bind(this)),h.currentNode=void 0,i(this)}renderDom(){var t;void 0!==this.__parent.element&&(null==(t=this.__parent.element)||t.append(...this.children.reduce(((t,e)=>{var i,s,n;const h=null==(n=null==(s=(i=e.attributes).$if)?void 0:s.call(i))||n,r=e.renderDom(h);return h?t.concat(r):t}),[])))}updateDom(){const t=this.__parent.element;t&&this.__queueDomUpdate((()=>{try{const e=[];n(this.__shouldRemoveIndices,(i=>{e.push(t.children[i])})),e.forEach((t=>t.remove())),n(this.__shouldUpdateIndices,(e=>t.replaceChild(this.children[e].renderDom(),t.children[e]))),n(this.__shouldAppendIndices,(e=>t.appendChild(this.children[e].renderDom())))}catch(e){}}))}onStateChange(t){if(!this.__isDynamic(this.__childSource))return;const e=this.children.slice(),i=this.__childSource().map((t=>t())),s=Math.max(i.length,e.length),n=[];let h,r,_;for(let a=0;a<s;a++)h=e[a],r=i[a],(null==h?void 0:h.attributes.$key)!==(null==r?void 0:r.attributes.$key)?void 0!==r||void 0===h?void 0!==h||void 0===r?void 0!==h&&void 0!==r&&(_=e.find((t=>!!t.attributes.$key&&t.attributes.$key===r.attributes.$key)),_?n[a]=_:(n[a]=r,this.__shouldUpdateIndices.push(a))):(n[a]=r,this.__shouldAppendIndices.push(a)):this.__shouldRemoveIndices.push(a):n[a]=h;this.children=n,this.updateDom()}__createChild(t){const e=t();return e.parent=this.__parent,e}__isDynamic(t){return"function"==typeof t}};let r=h;e(r,"currentNode");const _=[],a=class extends s{constructor(t,s,n,h=[]){super(),e(this,"parent"),e(this,"element"),e(this,"isFirstRender",!0),e(this,"__attributeState",{$if:!0}),e(this,"__changedStates",[]),e(this,"__boundEffects"),e(this,"__changedAttributes",[]),e(this,"__childNodeList"),e(this,"__doSetStaticAttributes",!0),e(this,"__dynamicAttributes",[]),e(this,"__doRenderDom",!1),e(this,"__mountingElement"),this.tag=t,this.attributes=s,this.__boundEffects=h,n&&(this.__childNodeList=new r(this,n)),this.__setAttributeState(),i(this)}static create(t,e={},i){const s=_.slice();return _.splice(0,_.length),()=>new a(t,e,i,s)}get html(){var t,e,i;return[`<${this.tag}`,Object.entries(this.__attributeState).reduce(((t,[e,i])=>[e.startsWith("$"),e.startsWith("on")].includes(!0)?t:t+` ${this.__getHtmlAttributeName(e)}="${i}"`),""),">",null!=(i=null!=(e=this.__attributeState.$text)?e:null==(t=this.__childNodeList)?void 0:t.children.map((t=>t.html)).join(""))?i:"",`</${this.tag}>`].join("")}get __parentElement(){var t,e;return null!=(e=null==(t=this.parent)?void 0:t.element)?e:this.__mountingElement}get __shouldRemove(){return this.__changedAttributes.includes("$if")&&!1===this.__attributeState.$if}get __shouldAppend(){return this.__changedAttributes.includes("$if")&&!0===this.__attributeState.$if}mount(t){this.__mountingElement=t,t.innerHTML="",t.appendChild(this.renderDom(!0))}renderDom(t=!1){var e;if(!this.isFirstRender)throw new Error("Use update method instead.");return this.__doRenderDom=!0,this.__setAttributeState(),this.element=document.createElement(this.tag),this.__setElementAttributes(),null==(e=this.__childNodeList)||e.renderDom(),this.isFirstRender=!1,t&&this.__queueDomUpdate((()=>{this.__boundEffects.forEach((t=>t.dispatch()))})),this.element}updateDom(){this.__doRenderDom&&(this.__queueDomUpdate(this.__setElementAttributes.bind(this),(()=>{n(this.__changedStates,(t=>{this.__boundEffects.forEach((e=>{e.dispatch(t)}))}))})),this.__shouldAppend!=this.__shouldRemove&&this.__queueDomUpdate((()=>{var t,e;this.element&&(this.__shouldAppend&&(null==(t=this.__parentElement)||t.appendChild(this.element)),this.__shouldRemove&&(null==(e=this.__parentElement)||e.removeChild(this.element)))}),this.__shouldAppend?()=>this.__boundEffects.forEach((t=>t.dispatch())):()=>this.__boundEffects.forEach((t=>t.cleanup()))))}onStateChange(t){this.__changedStates.push(t),this.__setAttributeState(),this.updateDom()}__setElementAttributes(){if(!this.element)return;(this.isFirstRender?Object.keys(this.__attributeState):this.__changedAttributes).forEach((t=>{const e=this.__attributeState[t];"$html"!==t?"$text"!==t?"on"!==t.substr(0,2)?"on"!==t.substr(0,2)&&"$"!==t[0]&&this.element.setAttribute(this.__getHtmlAttributeName(t),e):this.element[t]=e:this.element.innerText=null!=e?String(e):"":this.element.innerHTML=null!=e?String(e):""}))}__setAttributeState(){let t,e;a.currentNode=this,this.__changedAttributes.splice(0,this.__changedAttributes.length),this.__doSetStaticAttributes?Object.entries(this.attributes).forEach((([i,s])=>{e=this.__isDynamicAttribute(i,s),e?(this.__dynamicAttributes.push(i),t=s()):t=s,t!==this.__attributeState[i]&&(this.__changedAttributes.push(i),this.__attributeState[i]=t)})):this.__dynamicAttributes.forEach((e=>{t=this.attributes[e](),t!==this.__attributeState[e]&&(this.__changedAttributes.push(e),this.__attributeState[e]=t)})),a.currentNode=void 0,this.__doSetStaticAttributes=!1}__isDynamicAttribute(t,e){return"$if"===t||"on"!==t.substr(0,2)&&"function"==typeof e}__getHtmlAttributeName(t){switch(t){case"className":return"class"}return t.split(/(?=[A-Z])/).map((t=>t.toLowerCase())).join("-")}};let u=a;e(u,"currentNode");const c=t=>u.create.bind(void 0,t),d=c("a"),l=c("abbr"),o=c("acronym"),p=c("address"),m=c("area"),b=c("article"),f=c("aside"),g=c("audio"),S=c("b"),v=c("base"),A=c("bdi"),E=c("bdo"),y=c("big"),D=c("blink"),k=c("blockquote"),$=c("body"),N=c("br"),w=c("button"),I=c("canvas"),R=c("caption"),q=c("center"),C=c("cite"),x=c("code"),U=c("col"),j=c("colgroup"),Q=c("content"),F=c("data"),L=c("datalist"),O=c("dd"),H=c("del"),M=c("details"),T=c("dfn"),W=c("div"),P=c("dl"),Z=c("dt"),z=c("element"),B=c("em"),G=c("embed"),J=c("fieldset"),K=c("figcaption"),V=c("figure"),X=c("footer"),Y=c("form"),tt=c("h1"),et=c("h2"),it=c("h3"),st=c("h4"),nt=c("h5"),ht=c("h6"),rt=c("head"),_t=c("header"),at=c("hr"),ut=c("html"),ct=c("i"),dt=c("iframe"),lt=c("img"),ot=c("input"),pt=c("ins"),mt=c("kbd"),bt=c("label"),ft=c("legend"),gt=c("li"),St=c("link"),vt=c("main"),At=c("map"),Et=c("mark"),yt=c("menu"),Dt=c("meta"),kt=c("meter"),$t=c("nav"),Nt=c("noscript"),wt=c("object"),It=c("ol"),Rt=c("optgroup"),qt=c("option"),Ct=c("output"),xt=c("p"),Ut=c("param"),jt=c("plaintext"),Qt=c("pre"),Ft=c("progress"),Lt=c("q"),Ot=c("rp"),Ht=c("rt"),Mt=c("ruby"),Tt=c("s"),Wt=c("samp"),Pt=c("script"),Zt=c("section"),zt=c("select"),Bt=c("small"),Gt=c("source"),Jt=c("span"),Kt=c("strike"),Vt=c("strong"),Xt=c("style"),Yt=c("sub"),te=c("summary"),ee=c("sup"),ie=c("table"),se=c("tbody"),ne=c("td"),he=c("template"),re=c("textarea"),_e=c("tfoot"),ae=c("th"),ue=c("thead"),ce=c("time"),de=c("title"),le=c("tr"),oe=c("track"),pe=c("tt"),me=c("u"),be=c("ul"),fe=c("var"),ge=c("video"),Se=c("wbr");class ve{constructor(t){e(this,"__boundNodes",[]),e(this,"__internalState"),e(this,"__listeners",[]),this.__internalState=t,i(this)}get state(){const t=this.__boundNodes,e=u.currentNode,i=r.currentNode;return e&&!t.includes(e)&&t.push(e),i&&!t.includes(i)&&t.push(i),this.__internalState}set state(t){t!==this.__internalState&&(this.__internalState=t,this.__listeners.forEach((t=>t(this))),this.__boundNodes.forEach((t=>t.onStateChange(this))))}set(t){this.state=t(this.__internalState)}addListener(t){return this.__listeners.push(t),this}}function Ae(t){return new ve(t instanceof Function?t():t)}class Ee{constructor(t,s){e(this,"__callback"),e(this,"__cleanup"),e(this,"__watch"),this.__callback=t,this.__watch=s,i(this)}static isEffect(t){var e;return"Effect"===(null==(e=t.constructor)?void 0:e.name)}dispatch(t){t&&this.__watch&&!this.__watch.includes(t)||(this.__cleanup=this.__callback())}cleanup(){var t;null==(t=this.__cleanup)||t.call(this)}}function ye(t,e){"function"==typeof t?_.push(new Ee(t)):e&&_.push(new Ee(e,t))}export{Ee as Effect,ve as State,d as a,l as abbr,o as acronym,p as address,m as area,b as article,f as aside,g as audio,S as b,v as base,A as bdi,E as bdo,y as big,D as blink,k as blockquote,$ as body,N as br,w as button,I as canvas,R as caption,q as center,C as cite,x as code,U as col,j as colgroup,Q as content,F as data,L as datalist,O as dd,H as del,M as details,T as dfn,W as div,P as dl,Z as dt,ye as effect,z as element,B as em,G as embed,J as fieldset,K as figcaption,V as figure,X as footer,Y as form,tt as h1,et as h2,it as h3,st as h4,nt as h5,ht as h6,rt as head,_t as header,at as hr,ut as html,fe as htmlVar,ct as i,dt as iframe,lt as img,ot as input,pt as ins,mt as kbd,bt as label,ft as legend,gt as li,St as link,vt as main,At as map,Et as mark,yt as menu,Dt as meta,kt as meter,$t as nav,Nt as noscript,wt as object,It as ol,Rt as optgroup,qt as option,Ct as output,xt as p,Ut as param,jt as plaintext,Qt as pre,Ft as progress,Lt as q,Ot as rp,Ht as rt,Mt as ruby,Tt as s,Wt as samp,Pt as script,Zt as section,zt as select,Bt as small,Gt as source,Jt as span,Ae as state,Kt as strike,Vt as strong,Xt as style,Yt as sub,te as summary,ee as sup,ie as table,se as tbody,ne as td,he as template,re as textarea,_e as tfoot,ae as th,ue as thead,ce as time,de as title,le as tr,oe as track,pe as tt,me as u,be as ul,ge as video,Se as wbr};
