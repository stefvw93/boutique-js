var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);function i(t){Object.entries(t).forEach((([e,i])=>{const s=!e.startsWith("__"),n=t[e]instanceof Function;Object.defineProperty(t,e,{value:i,enumerable:s,configurable:s,writable:!n})}))}function s(t,e){for(;t.length>0;)e(t[0]),t.splice(0,1)}class n{constructor(){e(this,"__updateQueue",[]),e(this,"__callbackQueue",[]),e(this,"__requestId"),e(this,"__executeDomUpdates",(()=>{s(this.__updateQueue,(t=>t())),s(this.__callbackQueue,(t=>t()))})),i(this)}__queueDomUpdate(t,e){this.__requestId&&cancelAnimationFrame(this.__requestId),e&&this.__callbackQueue.push(e),t&&this.__updateQueue.push(t),this.__requestId=requestAnimationFrame(this.__executeDomUpdates)}}const r=class extends n{constructor(t,s){super(),e(this,"children",[]),e(this,"__parent"),e(this,"__childSource"),e(this,"__shouldUpdateIndices",[]),e(this,"__shouldAppendIndices",[]),e(this,"__shouldRemoveIndices",[]),this.__parent=t,this.__childSource=s,r.currentNode=this,this.children=this.__isDynamic(this.__childSource)?this.__childSource().map(this.__createChild.bind(this)):this.__childSource.map(this.__createChild.bind(this)),r.currentNode=void 0,i(this)}renderDom(){var t;void 0!==this.__parent.element&&(null==(t=this.__parent.element)||t.append(...this.children.reduce(((t,e)=>{var i,s,n;const r=null==(n=null==(s=(i=e.attributes).$if)?void 0:s.call(i))||n,h=e.renderDom(r);return r?t.concat(h):t}),[])))}updateDom(){const t=this.__parent.element;t&&this.__queueDomUpdate((()=>{try{const e=[];s(this.__shouldRemoveIndices,(i=>{e.push(t.children[i])})),e.forEach((t=>t.remove())),s(this.__shouldUpdateIndices,(e=>t.replaceChild(this.children[e].renderDom(),t.children[e]))),s(this.__shouldAppendIndices,(e=>t.appendChild(this.children[e].renderDom())))}catch(e){}}))}onStateChange(t){if(!this.__isDynamic(this.__childSource))return;const e=this.children.slice(),i=this.__childSource().map((t=>t())),s=Math.max(i.length,e.length),n=[];let r,h,_;for(let a=0;a<s;a++)r=e[a],h=i[a],(null==r?void 0:r.attributes.$key)!==(null==h?void 0:h.attributes.$key)?void 0!==h||void 0===r?void 0!==r||void 0===h?void 0!==r&&void 0!==h&&(_=e.find((t=>!!t.attributes.$key&&t.attributes.$key===h.attributes.$key)),_?n[a]=_:(n[a]=h,this.__shouldUpdateIndices.push(a))):(n[a]=h,this.__shouldAppendIndices.push(a)):this.__shouldRemoveIndices.push(a):n[a]=r;this.children=n,this.updateDom()}__createChild(t){const e=t();return e.parent=this.__parent,e}__isDynamic(t){return"function"==typeof t}};let h=r;e(h,"currentNode");const _=class extends n{constructor(t,s,n){super(),e(this,"parent"),e(this,"element"),e(this,"isFirstRender",!0),e(this,"__attributeState",{$if:!0}),e(this,"__changedStates",[]),e(this,"__changedAttributes",[]),e(this,"__childNodeList"),e(this,"__doSetStaticAttributes",!0),e(this,"__dynamicAttributes",[]),e(this,"__doRenderDom",!1),e(this,"__mountingElement"),this.tag=t,this.attributes=s,n&&(this.__childNodeList=new h(this,n)),this.__setAttributeState(),i(this)}static create(t,e={},i){return()=>new _(t,e,i)}get html(){var t,e,i;return[`<${this.tag}`,Object.entries(this.__attributeState).reduce(((t,[e,i])=>[e.startsWith("$"),this.__isEventName(e)].includes(!0)?t:t+` ${this.__getHtmlAttributeName(e)}="${i}"`),""),">",null!=(i=null!=(e=this.__attributeState.$text)?e:null==(t=this.__childNodeList)?void 0:t.children.map((t=>t.html)).join(""))?i:"",`</${this.tag}>`].join("")}get __parentElement(){var t,e;return null!=(e=null==(t=this.parent)?void 0:t.element)?e:this.__mountingElement}get __shouldRemove(){return this.__changedAttributes.includes("$if")&&!1===this.__attributeState.$if}get __shouldAppend(){return this.__changedAttributes.includes("$if")&&!0===this.__attributeState.$if}get __onAppend(){return this.__attributeState.$onAppend}get __onUpdate(){return this.__attributeState.$onUpdate}get __onRemove(){return this.__attributeState.$onRemove}mount(t){this.__mountingElement=t,t.innerHTML="",t.appendChild(this.renderDom(!0))}renderDom(t=!1){var e;if(!this.isFirstRender)throw new Error("Use update method instead.");return this.__doRenderDom=!0,this.__setAttributeState(),this.element=document.createElement(this.tag),this.__setElementAttributes(),null==(e=this.__childNodeList)||e.renderDom(),this.isFirstRender=!1,t&&this.__queueDomUpdate(void 0,(()=>{var t;return null==(t=this.__onAppend)?void 0:t.call(this,this.element)})),this.element}updateDom(){var t;this.__doRenderDom&&(this.__queueDomUpdate(this.__setElementAttributes.bind(this),null==(t=this.__onUpdate)?void 0:t.call(this,this.element)),this.__shouldAppend!=this.__shouldRemove&&this.__queueDomUpdate((()=>{var t,e;this.element&&(this.__shouldAppend&&(null==(t=this.__parentElement)||t.appendChild(this.element)),this.__shouldRemove&&(null==(e=this.__parentElement)||e.removeChild(this.element)))}),this.__shouldAppend?()=>{var t;return null==(t=this.__onAppend)?void 0:t.call(this,this.element)}:()=>{var t;return null==(t=this.__onRemove)?void 0:t.call(this,this.element)}))}onStateChange(t){this.__changedStates.push(t),this.__setAttributeState(),this.updateDom()}__setElementAttributes(){if(!this.element)return;(this.isFirstRender?Object.keys(this.__attributeState):this.__changedAttributes).forEach((t=>{const e=this.__attributeState[t];"$html"!==t?"$text"!==t?this.__isEventName(t)?this.element[this.__getHtmlAttributeName(t)]=e:"$"!==t[0]&&this.element.setAttribute(this.__getHtmlAttributeName(t),e):this.element.innerText=null!=e?String(e):"":this.element.innerHTML=null!=e?String(e):""}))}__setAttributeState(){let t,e;_.currentNode=this,this.__changedAttributes.splice(0,this.__changedAttributes.length),this.__doSetStaticAttributes?Object.entries(this.attributes).forEach((([i,s])=>{e=this.__isDynamicAttribute(i,s),t=e?s():s,this.__handleNewAttributeValue(i,t)})):this.__dynamicAttributes.forEach((e=>{t=this.attributes[e](),this.__handleNewAttributeValue(e,t)})),_.currentNode=void 0,this.__doSetStaticAttributes=!1}__handleNewAttributeValue(t,e){e!==this.__attributeState[t]&&(this.__changedAttributes.push(t),this.__attributeState[t]=e)}__isDynamicAttribute(t,e){return!t.startsWith("$on")&&("$if"===t||!this.__isEventName(t)&&"function"==typeof e)&&(this.__dynamicAttributes.push(t),!0)}__getHtmlAttributeName(t){if(this.__isEventName(t))return t.toLowerCase();switch(t){case"className":return"class"}return t.split(/(?=[A-Z])/).map((t=>t.toLowerCase())).join("-")}__isEventName(t){return t.startsWith("on")&&t.charAt(2)===t.charAt(2).toUpperCase()}};let a=_;e(a,"currentNode");const u=t=>a.create.bind(void 0,t),d=u("a"),o=u("abbr"),l=u("acronym"),c=u("address"),m=u("area"),p=u("article"),b=u("aside"),g=u("audio"),v=u("b"),f=u("base"),S=u("bdi"),A=u("bdo"),y=u("big"),N=u("blink"),D=u("blockquote"),$=u("body"),E=u("br"),k=u("button"),R=u("canvas"),C=u("caption"),w=u("center"),U=u("cite"),I=u("code"),q=u("col"),x=u("colgroup"),j=u("content"),L=u("data"),F=u("datalist"),H=u("dd"),O=u("del"),Q=u("details"),T=u("dfn"),W=u("div"),M=u("dl"),V=u("dt"),P=u("element"),Z=u("em"),z=u("embed"),B=u("fieldset"),G=u("figcaption"),J=u("figure"),K=u("footer"),X=u("form"),Y=u("h1"),tt=u("h2"),et=u("h3"),it=u("h4"),st=u("h5"),nt=u("h6"),rt=u("head"),ht=u("header"),_t=u("hr"),at=u("html"),ut=u("i"),dt=u("iframe"),ot=u("img"),lt=u("input"),ct=u("ins"),mt=u("kbd"),pt=u("label"),bt=u("legend"),gt=u("li"),vt=u("link"),ft=u("main"),St=u("map"),At=u("mark"),yt=u("menu"),Nt=u("meta"),Dt=u("meter"),$t=u("nav"),Et=u("noscript"),kt=u("object"),Rt=u("ol"),Ct=u("optgroup"),wt=u("option"),Ut=u("output"),It=u("p"),qt=u("param"),xt=u("plaintext"),jt=u("pre"),Lt=u("progress"),Ft=u("q"),Ht=u("rp"),Ot=u("rt"),Qt=u("ruby"),Tt=u("s"),Wt=u("samp"),Mt=u("script"),Vt=u("section"),Pt=u("select"),Zt=u("small"),zt=u("source"),Bt=u("span"),Gt=u("strike"),Jt=u("strong"),Kt=u("style"),Xt=u("sub"),Yt=u("summary"),te=u("sup"),ee=u("table"),ie=u("tbody"),se=u("td"),ne=u("template"),re=u("textarea"),he=u("tfoot"),_e=u("th"),ae=u("thead"),ue=u("time"),de=u("title"),oe=u("tr"),le=u("track"),ce=u("tt"),me=u("u"),pe=u("ul"),be=u("var"),ge=u("video"),ve=u("wbr"),fe=[];class Se{constructor(t){e(this,"__boundNodes",[]),e(this,"__listeners",[]),e(this,"__trackReadCalls",!0),e(this,"__internalState"),this.__internalState=t,i(this)}get state(){const t=this.__boundNodes,e=a.currentNode,i=h.currentNode;return this.__trackReadCalls&&(this.__trackReadCalls=!1,fe.push(this)),e&&!t.includes(e)&&t.push(e),i&&!t.includes(i)&&t.push(i),this.__internalState}set state(t){this.__updateState(t)}set(t){this.state=t(this.__internalState)}addListener(t){return this.__listeners.push(t),this}__updateState(t){t!==this.__internalState&&(this.__internalState=t,this.__listeners.forEach((t=>t(this.__internalState))),this.__boundNodes.forEach((t=>t.onStateChange(this))))}}function Ae(t){return new Se(t instanceof Function?t():t)}class ye extends Se{constructor(t){super(void 0),e(this,"__config"),this.__config=t,this.__internalState=t.getter(),s(fe,this.__handleTrackedStateUpdate.bind(this)),i(this)}__handleTrackedStateUpdate(t){t.addListener((()=>this.__updateState(this.__config.getter())))}set state(t){if(!this.__config.setter)throw new Error("Cannot update read-only state.");this.__config.setter(t)}}function Ne(t){return new ye(t instanceof Function?{getter:t}:t)}export{d as a,o as abbr,l as acronym,c as address,m as area,p as article,b as aside,g as audio,v as b,f as base,S as bdi,A as bdo,y as big,N as blink,D as blockquote,$ as body,E as br,k as button,R as canvas,C as caption,w as center,U as cite,I as code,q as col,x as colgroup,Ne as computed,j as content,L as data,F as datalist,H as dd,O as del,Q as details,T as dfn,W as div,M as dl,V as dt,P as element,Z as em,z as embed,B as fieldset,G as figcaption,J as figure,K as footer,X as form,Y as h1,tt as h2,et as h3,it as h4,st as h5,nt as h6,rt as head,ht as header,_t as hr,at as html,be as htmlVar,ut as i,dt as iframe,ot as img,lt as input,ct as ins,mt as kbd,pt as label,bt as legend,gt as li,vt as link,ft as main,St as map,At as mark,yt as menu,Nt as meta,Dt as meter,$t as nav,Et as noscript,kt as object,Rt as ol,Ct as optgroup,wt as option,Ut as output,It as p,qt as param,xt as plaintext,jt as pre,Lt as progress,Ft as q,Ht as rp,Ot as rt,Qt as ruby,Tt as s,Wt as samp,Mt as script,Vt as section,Pt as select,Zt as small,zt as source,Bt as span,Ae as state,Gt as strike,Jt as strong,Kt as style,Xt as sub,Yt as summary,te as sup,ee as table,ie as tbody,se as td,ne as template,re as textarea,he as tfoot,_e as th,ae as thead,ue as time,de as title,oe as tr,le as track,ce as tt,me as u,pe as ul,ge as video,ve as wbr};
